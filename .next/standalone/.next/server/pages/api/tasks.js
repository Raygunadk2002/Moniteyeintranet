"use strict";(()=>{var e={};e.id=806,e.ids=[806],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},4069:(e,t,r)=>{r.r(t),r.d(t,{config:()=>u,default:()=>d,routeModule:()=>c});var s={};r.r(s),r.d(s,{default:()=>l});var i=r(1802),o=r(7153),a=r(6249),n=r(6137);async function l(e,t){try{if("GET"===e.method){let{data:e,error:r}=await n.pR.from("task_columns").select("*").order("order_index");if(r)throw console.error("Error fetching task columns:",r),Error(`Failed to fetch task columns: ${r.message}`);let{data:s,error:i}=await n.pR.from("tasks").select("*").order("order_index");if(i)throw console.error("Error fetching tasks:",i),Error(`Failed to fetch tasks: ${i.message}`);let o=(e||[]).map(e=>({...e,tasks:(s||[]).filter(t=>t.column_id===e.id)})),a=s||[],l=a.filter(e=>"done"!==e.column_id),d=a.filter(e=>"done"===e.column_id),u=a.reduce((e,t)=>{let r=t.priority||"Medium";return e[r]=(e[r]||0)+1,e},{}),c=o.reduce((e,t)=>(e[t.title]=t.tasks.length,e),{}),f=new Date;f.setDate(f.getDate()-7);let m=a.filter(e=>new Date(e.created_at)>=f);t.status(200).json({total:a.length,open:l.length,completed:d.length,inProgress:a.filter(e=>"in-progress"===e.column_id).length,inReview:a.filter(e=>"review"===e.column_id).length,priorityCounts:u,columnCounts:c,recentTasks:m.length,completionRate:a.length>0?Math.round(d.length/a.length*100):0,tasks:a.map(e=>({id:e.id,title:e.title,priority:e.priority,assignee:e.assignee,tags:e.tags,created_at:e.created_at,column:o.find(t=>t.id===e.column_id)?.title})),columns:o})}else if("POST"===e.method){let{title:r,description:s,priority:i,assignee:o,tags:a,column_id:l}=e.body;if(!r||!l)return t.status(400).json({error:"Title and column_id are required"});let d=`task-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,{data:u}=await n.pR.from("tasks").select("order_index").eq("column_id",l).order("order_index",{ascending:!1}).limit(1),c=u&&u.length>0?u[0].order_index+1:0,{data:f,error:m}=await n.pR.from("tasks").insert({id:d,title:r,description:s,priority:i||"Medium",assignee:o,tags:a||[],column_id:l,order_index:c}).select().single();if(m)return console.error("Error creating task:",m),t.status(500).json({error:`Failed to create task: ${m.message}`});t.status(201).json(f)}else if("PUT"===e.method){let{id:r,title:s,description:i,priority:o,assignee:a,tags:l,column_id:d,order_index:u}=e.body;if(!r)return t.status(400).json({error:"Task ID is required"});let c={};void 0!==s&&(c.title=s),void 0!==i&&(c.description=i),void 0!==o&&(c.priority=o),void 0!==a&&(c.assignee=a),void 0!==l&&(c.tags=l),void 0!==d&&(c.column_id=d),void 0!==u&&(c.order_index=u);let{data:f,error:m}=await n.pR.from("tasks").update(c).eq("id",r).select().single();if(m)return console.error("Error updating task:",m),t.status(500).json({error:`Failed to update task: ${m.message}`});t.status(200).json(f)}else{if("DELETE"!==e.method)return t.status(405).json({message:"Method not allowed"});let{id:r}=e.body;if(!r)return t.status(400).json({error:"Task ID is required"});let{error:s}=await n.pR.from("tasks").delete().eq("id",r);if(s)return console.error("Error deleting task:",s),t.status(500).json({error:`Failed to delete task: ${s.message}`});t.status(200).json({message:"Task deleted successfully"})}}catch(e){console.error("Tasks API error:",e),t.status(500).json({total:0,open:0,completed:0,error:e instanceof Error?e.message:"Failed to fetch task data"})}}let d=(0,a.l)(s,"default"),u=(0,a.l)(s,"config"),c=new i.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/tasks",pathname:"/api/tasks",bundlePath:"",filename:""},userland:s})},6137:(e,t,r)=>{r.d(t,{OQ:()=>a,pR:()=>n});let s=require("@supabase/supabase-js"),i="https://tfskdfkzhqiiamziggoB.supabase.co",o=process.env.SUPABASE_SERVICE_ROLE_KEY,a=(0,s.createClient)(i,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRmc2tkZmt6aHFpaWFtemlnZ29iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk0Nzc3ODksImV4cCI6MjA2NTA1Mzc4OX0.wUR1GCbNEMrjcVRNG0l03Y0uXDgxd1y7wfAIGxSz5kA",{auth:{autoRefreshToken:!0,persistSession:!0},global:{fetch:(e,t={})=>fetch(e,{...t,signal:AbortSignal.timeout(3e4)})}}),n=(0,s.createClient)(i,o,{auth:{autoRefreshToken:!1,persistSession:!1},global:{fetch:(e,t={})=>fetch(e,{...t,signal:AbortSignal.timeout(45e3)})}})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=4069);module.exports=r})();