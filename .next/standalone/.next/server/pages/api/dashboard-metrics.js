"use strict";(()=>{var e={};e.id=850,e.ids=[850],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},5875:(e,t,a)=>{a.r(t),a.d(t,{config:()=>c,default:()=>l,routeModule:()=>u});var n={};a.r(n),a.d(n,{default:()=>s});var o=a(1802),r=a(7153),i=a(6249);async function s(e,t){if("GET"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let a=new Date().getFullYear(),n=await fetch(`https://app.timetastic.co.uk/api/publicholidays?year=${a}`,{headers:{Authorization:"Bearer acf87e83-3e43-42df-b7d6-861a69f90414","Content-Type":"application/json"}}),o=await n.json();Array.isArray(o)&&o.filter(e=>{let t=new Date(e.date),a=new Date;return t>a}).length;let r=await fetch(`${e.headers.origin||"http://localhost:3000"}/api/team-holidays-metrics`),i={next14Days:0,next30Days:0,currentlyOnHoliday:0,totalUpcoming:0};r.ok?i=await r.json():console.log("Failed to fetch team holidays data");let s=await fetch(`${e.headers.origin||"http://localhost:3000"}/api/pipedrive`),l={newDealsCount:0,newDealsValue:0,currency:"USD"};s.ok?l=await s.json():console.log("Failed to fetch Pipedrive data");let c=await fetch(`${e.headers.origin||"http://localhost:3000"}/api/tasks`),u={total:0,open:0,completed:0,inProgress:0,inReview:0,columnCounts:{},completionRate:0,tasks:[],columns:[]};c.ok?u=await c.json():console.log("Failed to fetch tasks data");let d=await fetch(`${e.headers.origin||"http://localhost:3000"}/api/revenue-data`),p={revenueData:[12,15,18,22,19,25]};d.ok?p=await d.json():console.log("Failed to fetch revenue data");let h=function(e,t){let a=Math.round((t/(e+t)-.5)*100);return`${a>0?"+":""}${a}%`}(u.open,u.completed),m=u.completed>u.open?"increase":"decrease",g=i.next14Days>0?`${i.next30Days} in 30d`:"None upcoming",y="GBP"===l.currency?"\xa3":"$",v={metrics:{totalRevenue:{value:"\xa3124,563",change:"+12.5%",changeType:"increase"},activeUsers:{value:"2,847",change:"+8.2%",changeType:"increase"},newDeals:{value:l.newDealsCount.toString(),change:"+8.7%",changeType:"increase"},dealsValue:{value:`${y}${l.newDealsValue.toLocaleString()}`,change:"+12.4%",changeType:"increase"},openTasks:{value:u.open.toString(),change:h,changeType:m},teamHolidays:{value:i.next14Days.toString(),change:g,changeType:"neutral"},sixMonthAverage:{value:"\xa372,564",change:"+8.3%",changeType:"increase"},twelveMonthTotal:{value:"\xa3864,379",change:"+12.1%",changeType:"increase"}},charts:{revenueData:p.revenueData,taskDistribution:u.total>0?[{name:"Completed",value:Math.round(u.completed/u.total*100),color:"#10B981",count:u.completed},{name:"In Progress",value:Math.round(u.inProgress/u.total*100),color:"#3B82F6",count:u.inProgress},{name:"In Review",value:Math.round(u.inReview/u.total*100),color:"#8B5CF6",count:u.inReview},{name:"Open",value:Math.round((u.total-u.completed-u.inProgress-u.inReview)/u.total*100),color:"#F59E0B",count:u.total-u.completed-u.inProgress-u.inReview}].filter(e=>e.value>0):[{name:"No Tasks",value:100,color:"#E5E7EB",count:0}]},activities:[{action:`${u.open} open tasks`,user:"Task System",time:"Live count",type:"task"},{action:`${u.completed}/${u.total} tasks completed (${u.completionRate}%)`,user:"Task System",time:"Live stats",type:"task"},{action:`${i.currentlyOnHoliday} team members on holiday`,user:"Holiday System",time:"Live count",type:"holiday"},{action:`${l.newDealsCount} new deals (${y}${l.newDealsValue.toLocaleString()})`,user:"Sales Team",time:"Last 30 days",type:"deal"},{action:"Dashboard refreshed",user:"System",time:"Just now",type:"system"}]};t.status(200).json(v)}catch(e){console.error("Dashboard API error:",e),t.status(500).json({error:"Failed to fetch dashboard data"})}}let l=(0,i.l)(n,"default"),c=(0,i.l)(n,"config"),u=new o.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/dashboard-metrics",pathname:"/api/dashboard-metrics",bundlePath:"",filename:""},userland:n})},7153:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},1802:(e,t,a)=>{e.exports=a(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=t(t.s=5875);module.exports=a})();